manifest {
    author            = 'Trevor F. Freeman'
    defaultBranch     = 'main'
    recurseSubmodules = true
    description       = 'A flexible pipeline for short read alignment to a reference.'
    mainScript        = 'main.nf'
    name              = 'SRAlign'
    nextflowVersion   = '>=21.04'
    version           = '0.1.1'
}

params {
    help = null

    /* 
    Base directories
    */

    // Input
    genomeBaseDir = "${PWD}/data/references"

    // Output
    baseDirReport = "${PWD}/results/reports"
    baseDirData   = "${PWD}/results/data"

    /*
    Raw reads QC
    */
    skipRawFastQC = false

    /*
    Trim reads and QC
    */
    trimTool = 'fastp'

    // Read-trimming control flow
    skipTrimReads   = false
    skipTrimReadsQC = false
    
    adapterR1 = 'CTGTCTCTTATACACATCT'
    adapterR2 = false

    /*
    Align
    */
    alignmentTool = 'bowtie2'

    // Alignment control flow
    forceAlignRawReads = false
    skipAlignGenome = false

    // Alignment stats
    skipSamStatsQC = false
}


profiles {
    docker {
        docker.enabled = true
    }
    google {
        process.executor = 'google-lifesciences'
        workDir = 'gs://sralign/scratch'
        google.location = 'us-central1'
        google.region  = 'us-central1'
        google.project = 'sralign'
    }
}


process {
    withLabel: mem_mid {
        memory = 2.GB
    }
    withLabel: cpu_mid {
        cpus = 2
    }
}


// Load genomes config files

includeConfig 'configs/genomes.config'


/*
    Reporting
*/

timestamp = new java.util.Date().format('yyyy-MM-dd_HH-mm')

dag {
    enabled = true
    file    = "${params.baseDirReport}/tracing/${timestamp}_dag.html"
}

report {
    enabled = true
    file    = "${params.baseDirReport}/tracing/${timestamp}_report.html"
}


timeline{
    enabled = true
    file    = "${params.baseDirReport}/tracing/${timestamp}_timeline.html"
}


trace {
    enabled = true
    file    = "${params.baseDirReport}/tracing/${timestamp}_trace.html"
}
